{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "a5fe6bb6",
   "metadata": {},
   "outputs": [],
   "source": [
    "import geemap, ee\n",
    "\n",
    "try:\n",
    "        ee.Initialize()\n",
    "except Exception as e:\n",
    "        ee.Authenticate()\n",
    "        ee.Initialize()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "3b745461",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "47d17945411646e59bde994b96b42986",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Map(center=[19.43, -99.13], controls=(WidgetControl(options=['position', 'transparent_bg'], widget=HBox(childr…"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# # initialize our map and center on Mexico City, Mexico\n",
    "lat = 19.43\n",
    "lon = -99.13\n",
    "map1 = geemap.Map(center=[lat,lon],zoom=6)\n",
    "map1.add_basemap('SATELLITE')\n",
    "\n",
    "# get 1996 composite, apply mask, and add as layer\n",
    "dmsp1996 = ee.Image(\"NOAA/DMSP-OLS/NIGHTTIME_LIGHTS/F121996\").select('stable_lights')\n",
    "map1.addLayer(dmsp1996, {'min':0, 'max':63}, \"DMSP-OLS 1996\", opacity=0.75)\n",
    "map1.addLayerControl()\n",
    "map1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "30763564",
   "metadata": {},
   "outputs": [],
   "source": [
    "dmsp1996_inv = dmsp1996.multiply(-1).add(63)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "fcc287cd",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "09926f3960604662baa2eaeab4feabfa",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Map(center=[19.43, -99.13], controls=(WidgetControl(options=['position', 'transparent_bg'], widget=HBox(childr…"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "map2 = geemap.Map(center=[lat,lon],zoom=6)\n",
    "map2.addLayerControl()\n",
    "\n",
    "dmsp96_tile = geemap.ee_tile_layer(dmsp1996, {'min':0,'max':63}, 'DMSP NTL 1996', opacity=0.75)\n",
    "dmsp96inv_tile = geemap.ee_tile_layer(dmsp1996_inv, {'min':0,'max':63}, 'DMSP NTL 1996 inverse', opacity=0.75)\n",
    "\n",
    "map2.split_map(left_layer=dmsp96_tile, right_layer=dmsp96inv_tile)\n",
    "\n",
    "map2"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "0d54f12d",
   "metadata": {},
   "outputs": [],
   "source": [
    "# # initialize our map and center on Mexico City, Mexico\n",
    "lat = 19.43\n",
    "lon = -99.13\n",
    "\n",
    "# get 1996 composite, apply mask, and add as layer\n",
    "dmsp1996 = ee.Image(\"NOAA/DMSP-OLS/NIGHTTIME_LIGHTS/F121996\").select('stable_lights')\n",
    "dmsp1996_inv = dmsp1996.multiply(-1).add(63)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "a2f8dd4c",
   "metadata": {},
   "outputs": [],
   "source": [
    "inv_formula = \"(X*-1) + 63\"\n",
    "\n",
    "# we plug this formula in, identify our variable \"X\" and set it to our 1996 DMSP-OLS \"stable_lights\" band\n",
    "dmsp1996_inv2 = dmsp1996.expression(inv_formula, {'X':dmsp1996})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "04d6dfaf",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "7911cab9994b46ee9c4d20bda924570d",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Map(center=[19.43, -99.13], controls=(WidgetControl(options=['position', 'transparent_bg'], widget=HBox(childr…"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "map1 = geemap.Map(center=[lat,lon],zoom=6)\n",
    "map1.addLayerControl()\n",
    "\n",
    "dmsp96inv_tile = geemap.ee_tile_layer(dmsp1996_inv, {'min':0,'max':63}, 'DMSP 96 inverse', opacity=0.75)\n",
    "dmsp96inv_tile2 = geemap.ee_tile_layer(dmsp1996_inv2, {'min':0,'max':63}, 'DMSP 96 inverse 2nd method', opacity=0.75)\n",
    "\n",
    "\n",
    "map1.split_map(left_layer=dmsp96inv_tile, right_layer=dmsp96inv_tile2)\n",
    "map1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "e96483be",
   "metadata": {},
   "outputs": [],
   "source": [
    "# set our formula\n",
    "F121996cal = '-0.0959 + (1.2727 * X) + (-0.0040 * X * X)'\n",
    "\n",
    "# apply our expression to our 1996 composite\n",
    "# dmsp1996 = ee.Image(\"NOAA/DMSP-OLS/NIGHTTIME_LIGHTS/F121996\").select('stable_lights')\n",
    "dmsp1996_clbr = dmsp1996.expression(F121996cal,{'X':dmsp1996})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "f900df13",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "aef032b848d146fb9bc8267123d0ca2c",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Map(center=[19.43, -99.13], controls=(WidgetControl(options=['position', 'transparent_bg'], widget=HBox(childr…"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "map2 = geemap.Map(center=[lat,lon],zoom=9)\n",
    "map2.addLayerControl()\n",
    "\n",
    "mask96 = geemap.ee_tile_layer(dmsp1996.mask(dmsp1996), {'min':0,'max':63}, 'DMSP NTL 1996', opacity=0.75)\n",
    "adj96 = geemap.ee_tile_layer(dmsp1996_clbr.mask(dmsp1996_clbr), {'min':0,'max':63}, 'DMSP NTL 1996 adjusted', opacity=0.75)\n",
    "\n",
    "map2.split_map(left_layer=mask96, right_layer=adj96)\n",
    "map2"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python (onl)",
   "language": "python",
   "name": "onl"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
